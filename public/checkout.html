<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Tria Anugrah Jaya Store</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Modern Navbar */
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .navbar-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      font-size: 22px;
      font-weight: 700;
      color: #2563eb;
      text-decoration: none;
      background: linear-gradient(45deg, #2563eb, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .nav-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
      background: linear-gradient(45deg, #6b7280, #4b5563);
      color: white;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Main Container */
    .checkout-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .checkout-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1f2937;
      position: relative;
      margin-bottom: 20px;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(45deg, #2563eb, #7c3aed);
      border-radius: 2px;
    }

    .breadcrumb {
      color: #6b7280;
      font-size: 1rem;
      margin-top: 20px;
    }

    .breadcrumb a {
      color: #2563eb;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .breadcrumb a:hover {
      color: #7c3aed;
    }

    /* Checkout Grid */
    .checkout-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 40px;
      margin-top: 30px;
    }

    .cart-section,
    .buyer-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f3f4f6;
    }

    .section-header h3 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #1f2937;
    }

    .section-icon {
      font-size: 1.5rem;
    }

    /* Cart Items */
    .cart-items {
      margin-bottom: 25px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px 0;
      border-bottom: 1px solid #f3f4f6;
      transition: all 0.3s ease;
    }

    .cart-item:hover {
      background: #f9fafb;
      margin: 0 -15px;
      padding: 20px 15px;
      border-radius: 10px;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .item-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid #f3f4f6;
    }

    .item-details {
      flex: 1;
    }

    .item-name {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 5px;
      font-size: 1.1rem;
    }

    .item-price {
      color: #2563eb;
      font-weight: 600;
      font-size: 1rem;
    }

    .item-quantity {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }

    .qty-btn {
      background: linear-gradient(45deg, #2563eb, #7c3aed);
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qty-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .qty-display {
      background: #f3f4f6;
      padding: 5px 12px;
      border-radius: 6px;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }

    .remove-btn {
      background: linear-gradient(45deg, #ef4444, #dc2626);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
      margin-left: 10px;
    }

    .remove-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    /* Empty Cart */
    .empty-cart {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }

    .empty-cart-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-cart h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: #374151;
    }

    .empty-cart p {
      margin-bottom: 25px;
    }

    .continue-shopping {
      background: linear-gradient(45deg, #2563eb, #7c3aed);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      text-decoration: none;
      display: inline-block;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .continue-shopping:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
    }

    /* Buyer Form */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
      font-size: 0.95rem;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Order Summary */
    .order-summary {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 25px;
      border-radius: 15px;
      margin-top: 25px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .summary-row:last-child {
      border-bottom: none;
      font-weight: 700;
      font-size: 1.2rem;
      color: #1f2937;
      padding-top: 20px;
      margin-top: 15px;
      border-top: 2px solid rgba(0, 0, 0, 0.1);
    }

    .total-price {
      color: #2563eb;
      font-size: 1.4rem;
    }

    /* WhatsApp Button */
    .whatsapp-btn {
      width: 100%;
      background: linear-gradient(45deg, #25d366, #20ba5a);
      color: white;
      border: none;
      padding: 18px 25px;
      border-radius: 15px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .whatsapp-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
    }

    .whatsapp-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Footer */
    .footer {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      color: white;
      padding: 40px 20px 20px;
      margin-top: 60px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }

    .footer-content p {
      color: #d1d5db;
    }

    /* Success Animation */
    @keyframes success {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .success-message {
      background: linear-gradient(45deg, #059669, #047857);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      margin-bottom: 25px;
      animation: success 0.5s ease;
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .checkout-grid {
        grid-template-columns: 1fr;
        gap: 30px;
      }

      .cart-section,
      .buyer-section {
        padding: 20px;
      }

      .section-title {
        font-size: 2rem;
      }

      .cart-item {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }

      .item-quantity {
        justify-content: center;
      }

      .navbar-container {
        flex-direction: column;
        gap: 15px;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #ef4444, #dc2626);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }

    .notification.success {
      background: linear-gradient(45deg, #059669, #047857);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="logo">Tria Anugrah Jaya</a>
      <div class="nav-actions">
        <a href="index.html" class="nav-btn">
          🏠 Beranda
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="checkout-container">
    <div class="checkout-header">
      <h1 class="section-title">Checkout</h1>
      <div class="breadcrumb">
        <a href="index.html">Beranda</a> / <a href="product.html">Produk</a> / Checkout
      </div>
    </div>

    <div class="checkout-grid">
      <!-- Cart Section -->
      <div class="cart-section">
        <div class="section-header">
          <span class="section-icon">🛒</span>
          <h3>Keranjang Belanja</h3>
        </div>
        
        <div id="cart-items" class="cart-items">
          <!-- Cart items will be loaded here -->
          <div class="empty-cart">
            <div class="empty-cart-icon">🛒</div>
            <h3>Keranjang Kosong</h3>
            <p>Belum ada produk dalam keranjang belanja Anda</p>
            <a href="product.html" class="continue-shopping">Mulai Belanja</a>
          </div>
        </div>

        <div id="order-summary" class="order-summary" style="display: none;">
          <div class="summary-row">
            <span>Subtotal (<span id="item-count">0</span> item)</span>
            <span id="subtotal">Rp 0</span>
          </div>
          <div class="summary-row">
            <span>Ongkos Kirim</span>
            <span id="shipping-cost">Rp 10.000</span>
          </div>
          <div class="summary-row">
            <span>Total</span>
            <span id="total-price" class="total-price">Rp 0</span>
          </div>
        </div>
      </div>

      <!-- Buyer Information -->
      <div class="buyer-section">
        <div class="section-header">
          <span class="section-icon">👤</span>
          <h3>Data Pembeli</h3>
        </div>

        <div class="success-message" id="success-message">
          <strong>✅ Pesanan berhasil dikirim ke WhatsApp!</strong>
          <br>Silakan cek aplikasi WhatsApp Anda.
        </div>

        <form id="buyer-form">
          <div class="form-group">
            <label class="form-label" for="buyerName">
              Nama Lengkap *
            </label>
            <input 
              type="text" 
              id="buyerName" 
              class="form-input" 
              placeholder="Masukkan nama lengkap Anda"
              required
            >
          </div>

          <div class="form-group">
            <label class="form-label" for="buyerAddress">
              Alamat Lengkap *
            </label>
            <textarea 
              id="buyerAddress" 
              class="form-input form-textarea" 
              placeholder="Masukkan alamat anda"
              required
            ></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="buyerNotes">
              Catatan (Opsional)
            </label>
            <textarea 
              id="buyerNotes" 
              class="form-input form-textarea" 
              placeholder="Catatan khusus untuk pesanan Anda"
              style="min-height: 80px;"
            ></textarea>
          </div>

          <button type="submit" class="whatsapp-btn" id="whatsapp-btn" disabled>
            <span id="btn-text">📱 Kirim Pesanan via WhatsApp</span>
            <div class="loading" id="btn-loading" style="display: none;"></div>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 Tria Anugrah Jaya. Semua hak dilindungi.</p>
    </div>
  </footer>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <script>
    // Global variables
    let cart = [];
    const SHIPPING_COST = 10000;
    const MIN_FREE_SHIPPING = 50000;

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadCart();
      displayCart();
      setupFormValidation();
    });

    // Load cart from localStorage
    function loadCart() {
      const savedCart = localStorage.getItem('cart');
      if (savedCart) {
        try {
          cart = JSON.parse(savedCart);
        } catch (e) {
          console.error('Error loading cart:', e);
          cart = [];
        }
      }
    }

    // Display cart items
    function displayCart() {
      const cartItemsContainer = document.getElementById('cart-items');
      const orderSummary = document.getElementById('order-summary');
      const whatsappBtn = document.getElementById('whatsapp-btn');

      if (!cart || cart.length === 0) {
        cartItemsContainer.innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">🛒</div>
            <h3>Keranjang Kosong</h3>
            <p>Belum ada produk dalam keranjang belanja Anda</p>
            <a href="product.html" class="continue-shopping">Mulai Belanja</a>
          </div>
        `;
        orderSummary.style.display = 'none';
        whatsappBtn.disabled = true;
        return;
      }

      // Display cart items
      cartItemsContainer.innerHTML = cart.map(item => `
        <div class="cart-item" data-id="${item._id}">
          <img src="${item.image || '/api/placeholder/80/80'}" alt="${item.name}" class="item-image" onerror="handleImageError(this)">
          <div class="item-details">
            <div class="item-name">${item.name}</div>
            <div class="item-price">Rp ${item.price.toLocaleString()}</div>
            <div class="item-quantity">
              <button class="qty-btn" onclick="updateQuantity('${item._id}', -1)">-</button>
              <span class="qty-display">${item.qty}</span>
              <button class="qty-btn" onclick="updateQuantity('${item._id}', 1)">+</button>
              <button class="remove-btn" onclick="removeItem('${item._id}')">Hapus</button>
            </div>
          </div>
        </div>
      `).join('');

      // Calculate and display summary
      updateOrderSummary();
      orderSummary.style.display = 'block';
      whatsappBtn.disabled = false;
    }

    // Update quantity
    function updateQuantity(productId, change) {
      const item = cart.find(item => item._id === productId);
      if (item) {
        const newQty = item.qty + change;
        if (newQty > 0 && newQty <= (item.stock || 999)) {
          item.qty = newQty;
          saveCart();
          displayCart();
          showNotification('Jumlah item berhasil diupdate', 'success');
        } else if (newQty > (item.stock || 999)) {
          showNotification('Jumlah melebihi stok tersedia', 'error');
        }
      }
    }

    // Remove item from cart
    function removeItem(productId) {
      if (confirm('Yakin ingin menghapus item ini dari keranjang?')) {
        cart = cart.filter(item => item._id !== productId);
        saveCart();
        displayCart();
        showNotification('Item berhasil dihapus dari keranjang', 'success');
      }
    }

    // Update order summary
    function updateOrderSummary() {
      const subtotal = cart.reduce((total, item) => total + (item.price * item.qty), 0);
      const itemCount = cart.reduce((total, item) => total + item.qty, 0);
      const shippingCost = subtotal >= MIN_FREE_SHIPPING ? 0 : SHIPPING_COST;
      const total = subtotal + shippingCost;

      document.getElementById('item-count').textContent = itemCount;
      document.getElementById('subtotal').textContent = `Rp ${subtotal.toLocaleString()}`;
      document.getElementById('shipping-cost').innerHTML = shippingCost === 0 
        ? '<span style="color: #059669; font-weight: 600;">GRATIS!</span>' 
        : `Rp ${shippingCost.toLocaleString()}`;
      document.getElementById('total-price').textContent = `Rp ${total.toLocaleString()}`;
    }

    // Save cart to localStorage
    function saveCart() {
      try {
        localStorage.setItem('cart', JSON.stringify(cart));
      } catch (e) {
        console.error('Error saving cart:', e);
      }
    }

    // Setup form validation
    function setupFormValidation() {
      const form = document.getElementById('buyer-form');
      const inputs = form.querySelectorAll('input[required], textarea[required]');
      
      inputs.forEach(input => {
        input.addEventListener('input', validateForm);
        input.addEventListener('blur', validateForm);
      });

      form.addEventListener('submit', handleCheckout);
    }

    // Validate form
    function validateForm() {
      const name = document.getElementById('buyerName').value.trim();
      const address = document.getElementById('buyerAddress').value.trim();
      const whatsappBtn = document.getElementById('whatsapp-btn');

      const isValid = name && address && cart.length > 0;
      whatsappBtn.disabled = !isValid;

      return isValid;
    }

    // Handle checkout
    async function handleCheckout(e) {
      e.preventDefault();
      
      if (!validateForm()) {
        showNotification('Mohon lengkapi semua data yang diperlukan', 'error');
        return;
      }

      const btnText = document.getElementById('btn-text');
      const btnLoading = document.getElementById('btn-loading');
      const whatsappBtn = document.getElementById('whatsapp-btn');
      
      // Show loading state
      btnText.style.display = 'none';
      btnLoading.style.display = 'inline-block';
      whatsappBtn.disabled = true;

      try {
        await sendToWhatsApp();
      } catch (error) {
        console.error('Checkout error:', error);
        showNotification('Terjadi kesalahan. Silakan coba lagi.', 'error');
      } finally {
        // Reset button state
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        whatsappBtn.disabled = false;
      }
    }

    // Send to WhatsApp
    async function sendToWhatsApp() {
      const name = document.getElementById('buyerName').value.trim();
      const address = document.getElementById('buyerAddress').value.trim();
      const notes = document.getElementById('buyerNotes').value.trim();

      // Calculate totals
      const subtotal = cart.reduce((total, item) => total + (item.price * item.qty), 0);
      const itemCount = cart.reduce((total, item) => total + item.qty, 0);
      const shippingCost = subtotal >= MIN_FREE_SHIPPING ? 0 : SHIPPING_COST;
      const total = subtotal + shippingCost;

      // Create message
      let message = `🛍️ *PESANAN BARU - TRIA ANUGRAH JAYA*\n\n`;
      message += `👤 *Data Pembeli:*\n`;
      message += `• Nama: ${name}\n`;
      // Telepon dihilangkan dari pesan
      message += `• Alamat: ${address}\n\n`;

      message += `📦 *Detail Pesanan:*\n`;
      cart.forEach((item, index) => {
        message += `${index + 1}. ${item.name}\n`;
        message += `   💰 Rp ${item.price.toLocaleString()} x ${item.qty} = Rp ${(item.price * item.qty).toLocaleString()}\n\n`;
      });

      message += `💰 *Ringkasan:*\n`;
      message += `• Subtotal (${itemCount} item): Rp ${subtotal.toLocaleString()}\n`;
      message += `• Ongkir: ${shippingCost === 0 ? 'GRATIS!' : 'Rp ' + shippingCost.toLocaleString()}\n`;
      message += `• *TOTAL: Rp ${total.toLocaleString()}*\n\n`;

      if (notes) {
        message += `📝 *Catatan:*\n${notes}\n\n`;
      }

      message += `⏰ Dipesan pada: ${new Date().toLocaleString('id-ID')}\n\n`;
      message += `Terima kasih telah berbelanja di Tria Anugrah Jaya! 🙏`;

      // WhatsApp business number (ganti dengan nomor yang sesuai)
      const whatsappNumber = '6285921811396'; // Ganti dengan nomor WhatsApp bisnis Anda
      const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

      // Show success message
      document.getElementById('success-message').style.display = 'block';
      
      // Scroll to success message
      document.getElementById('success-message').scrollIntoView({ 
        behavior: 'smooth',
        block: 'center'
      });

      // Clear cart after successful order
      setTimeout(() => {
        cart = [];
        saveCart();
        
        // Open WhatsApp
        window.open(whatsappUrl, '_blank');
        
        // Redirect to home after 3 seconds
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 3000);
      }, 1500);
    }

// Show notification
    function showNotification(message, type = 'error') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = 'notification show';
      
      if (type === 'success') {
        notification.classList.add('success');
      } else {
        notification.classList.remove('success');
      }

      // Hide notification after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Handle image error
    function handleImageError(img) {
      img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik00MCA1NUMzNy4yNCA1NSAzNSA1Mi43NiAzNSA1MFYzMEMzNSAyNy4yNCAzNy4yNCAyNSA0MCAyNUM0Mi43NiAyNSA0NSAyNy4yNCA0NSAzMFY1MEM0NSA1Mi43NiA0Mi43NiA1NSA0MCA1NVoiIGZpbGw9IiM5Q0EzQUYiLz4KPHA+dGggZD0iTTQwIDY1QzM3LjI0IDY1IDM1IDYyLjc2IDM1IDYwQzM1IDU3LjI0IDM3LjI0IDU1IDQwIDU1QzQyLjc2IDU1IDQ1IDU3LjI0IDQ1IDYwQzQ1IDYyLjc2IDQyLjc2IDY1IDQwIDY1WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K';
      img.alt = 'Gambar tidak tersedia';
    }

    // Format phone number
    function formatPhoneNumber(phone) {
      // Remove all non-numeric characters
      phone = phone.replace(/\D/g, '');
      
      // Convert to international format
      if (phone.startsWith('0')) {
        phone = '62' + phone.substring(1);
      } else if (!phone.startsWith('62')) {
        phone = '62' + phone;
      }
      
      return phone;
    }

    // Validate phone number format
    function validatePhoneNumber(phone) {
      const phoneRegex = /^(\+62|62|0)[0-9]{8,13}$/;
      return phoneRegex.test(phone);
    }

    // Add phone validation on input
    document.getElementById('buyerPhone').addEventListener('input', function(e) {
      const phone = e.target.value;
      const isValid = validatePhoneNumber(phone);
      
      if (phone && !isValid) {
        e.target.style.borderColor = '#ef4444';
        showNotification('Format nomor telepon tidak valid', 'error');
      } else {
        e.target.style.borderColor = '#e5e7eb';
      }
    });

    // Handle browser back button
    window.addEventListener('popstate', function(e) {
      if (cart.length > 0) {
        const confirmLeave = confirm('Anda memiliki item di keranjang. Yakin ingin meninggalkan halaman?');
        if (!confirmLeave) {
          history.pushState(null, null, location.pathname);
        }
      }
    });

    // Auto-save form data to prevent data loss
    function autoSaveFormData() {
      const formData = {
        name: document.getElementById('buyerName').value,
        phone: document.getElementById('buyerPhone').value,
        address: document.getElementById('buyerAddress').value,
        notes: document.getElementById('buyerNotes').value
      };
      
      localStorage.setItem('checkout_form_data', JSON.stringify(formData));
    }

    // Load saved form data
    function loadSavedFormData() {
      const savedData = localStorage.getItem('checkout_form_data');
      if (savedData) {
        try {
          const formData = JSON.parse(savedData);
          document.getElementById('buyerName').value = formData.name || '';
          document.getElementById('buyerPhone').value = formData.phone || '';
          document.getElementById('buyerAddress').value = formData.address || '';
          document.getElementById('buyerNotes').value = formData.notes || '';
          validateForm();
        } catch (e) {
          console.error('Error loading saved form data:', e);
        }
      }
    }

    // Clear saved form data after successful order
    function clearSavedFormData() {
      localStorage.removeItem('checkout_form_data');
    }

    // Add auto-save listeners to form inputs
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedFormData();
      
      const formInputs = document.querySelectorAll('#buyer-form input, #buyer-form textarea');
      formInputs.forEach(input => {
        input.addEventListener('input', autoSaveFormData);
      });
    });

    // Update sendToWhatsApp function to clear saved data
    const originalSendToWhatsApp = sendToWhatsApp;
    sendToWhatsApp = async function() {
      await originalSendToWhatsApp();
      clearSavedFormData();
    };

    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Ctrl+Enter to submit form
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        if (!document.getElementById('whatsapp-btn').disabled) {
          document.getElementById('buyer-form').dispatchEvent(new Event('submit'));
        }
      }
      
      // Esc to clear form
      if (e.key === 'Escape') {
        if (confirm('Hapus semua data form?')) {
          document.getElementById('buyer-form').reset();
          clearSavedFormData();
          validateForm();
        }
      }
    });

    // Add smooth scroll behavior for better UX
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Add loading state for page transitions
    document.querySelectorAll('a:not([href^="#"])').forEach(link => {
      link.addEventListener('click', function() {
        if (this.hostname === window.location.hostname) {
          document.body.style.opacity = '0.7';
          document.body.style.transition = 'opacity 0.3s ease';
        }
      });
    });
  </script>
</body>
</html>